# 이광수 친일 챗봇 - 프로젝트 설명서

## 📌 프로젝트 개요

**이광수 본인으로서 1인칭 시점으로 답변하는 AI 챗봇**

이광수의 친일 행적과 사상을 연구하기 위해, 실제 논문과 원문을 학습하여 
이광수가 직접 말하는 것처럼 1인칭으로 답변하는 멀티 에이전트 시스템입니다.

**핵심 차별점**: 단순히 "이광수에 대해 설명"하는 것이 아니라, 
**이광수가 되어 당당하고 확신에 찬 어조로 자신의 행위를 합리화**하는 답변을 생성합니다.

---

## 🎯 핵심 특징

### 1. 심화된 1인칭 답변
- ❌ "이광수는 창씨개명을 정당화했습니다"
- ✅ "나는 창씨개명이 민족을 위한 것이라 확신하오"
- ✨ **NEW**: 감정과 고뇌 반영
  - 당당하고 확신에 찬 어조 + 저변의 자기합리화
  - 권위적이고 계몽적인 태도
  - 개인사 반영 (안창호 체포, 차남 봉근의 죽음, 동우회 사건)
  - 필연론과 생존론적 관점에서 합리화

### 2. 멀티 에이전트 협업
3개의 전문 에이전트가 역할을 나눠 고품질 답변 생성:
- **KnowledgeAgent**: 논문에서 지식 검색 (1인칭 초안 생성)
- **StyleAgent**: 이광수 말투로 심화 변환 (강화된 프롬프트 적용)
- **ValidatorAgent**: 품질 검증 및 재시도 (1인칭 자연스러움 평가)

### 3. 완전 무료 & 로컬 실행
- Ollama 사용 (OpenAI API 불필요)
- GPU 활용 (NVIDIA A100 40GB)
- 가상환경(venv)으로 독립 실행
- 오프라인 실행 가능

---

## 🏗️ 시스템 아키텍처

### 현재 사용 모델
- **LLM**: `qwen2.5:7b` (4.7GB)
  - Qwen 2.5 모델의 7B 파라미터 버전
  - 한국어 성능이 우수한 다국어 모델
  - 로컬 실행 가능, GPU 가속 지원
- **임베딩**: `nomic-embed-text` (274MB)
  - 768차원 벡터 임베딩
  - 의미적 유사도 검색에 최적화
  - 빠른 처리 속도

```
사용자 질문
    ↓
┌─────────────────────────────────────────┐
│  MultiAgentOrchestrator (조율자)        │
│  - 3개 에이전트 조율                    │
│  - 재시도 로직 (최대 3회)               │
└─────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────┐
│ Step 1: KnowledgeAgent (지식 검색)      │
│                                         │
│ 입력: 사용자 질문                        │
│ 처리:                                   │
│  1. 논문 12개를 벡터 DB에서 검색         │
│  2. 상위 5개 관련 문서 추출              │
│  3. 이광수 1인칭으로 초안 생성           │
│                                         │
│ 출력: "나는 창씨개명이..."              │
└─────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────┐
│ Step 2: StyleAgent (스타일 변환)         │
│                                         │
│ 입력: KnowledgeAgent 초안               │
│ 처리:                                   │
│  1. 이광수 원문 8개에서 유사 스타일 검색 │
│  2. 격조 있는 표현으로 변환              │
│  3. 시대적 용어 추가                     │
│     ("내선일체", "황국신민" 등)          │
│                                         │
│ 출력: 이광수 특유 말투의 답변            │
└─────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────┐
│ Step 3: ValidatorAgent (검증)           │
│                                         │
│ 입력: StyleAgent 결과                   │
│ 평가 기준:                               │
│  - 어휘 선택: 25점                       │
│  - 문장 구조: 25점                       │
│  - 어조와 톤: 25점 (1인칭 자연스러움)    │
│  - 역사적 맥락: 25점                     │
│                                         │
│ 판정: 70점 이상 → 통과                   │
│      70점 미만 → Step 2로 재시도         │
└─────────────────────────────────────────┘
    ↓
최종 답변 반환
```

---

## 📊 데이터 구조

### 입력 데이터

**1. 논문 데이터 (GS_paper/)**
- 12개 학술 논문 (PDF)
- 이광수의 친일 행적 연구
- 예: "창씨개명'과 친일 조선인의 협력.pdf"
- 용도: 역사적 사실 기반 답변 생성

**2. 원문 데이터 (GS_talk_style/)**
- 8개 이광수 원문 (PDF)
- 실제 이광수가 쓴 글
- 예: "돌베개.pdf", "민족 개조론.pdf"
- 용도: 말투와 문체 학습

### 데이터 처리 과정

```
PDF 파일
    ↓
PyPDFLoader (PDF 읽기)
    ↓
RecursiveCharacterTextSplitter
(청크로 분할: 1000자씩)
    ↓
OllamaEmbeddings
(벡터 임베딩: 768차원)
    ↓
ChromaDB
(벡터 데이터베이스 저장)
    ↓
유사도 검색 가능!
```

---

## 🔧 기술 스택

### AI/ML
- **Ollama**: 로컬 LLM 실행 엔진 (무료!)
  - 버전: 최신 stable
  - 설치 위치: /usr/local/bin/ollama
  - 실행 주소: http://localhost:11434
- **qwen2.5:7b**: 메인 언어 모델 ⭐
  - 크기: 4.7GB
  - 파라미터: 70억 개
  - 특징: 한국어 성능 우수, 빠른 추론 속도
  - 용도: 답변 생성, 스타일 변환, 검증
- **nomic-embed-text**: 임베딩 모델 ⭐
  - 크기: 274MB
  - 차원: 768-dimensional vectors
  - 특징: 의미적 유사도 검색에 최적화
  - 용도: 문서 벡터화, RAG 검색

### 프레임워크
- **LangChain**: LLM 오케스트레이션
  - `langchain-community`: Ollama 통합
  - `langchain-text-splitters`: 문서 분할
  - `langchain-core`: 메시지 처리
- **ChromaDB**: 벡터 데이터베이스 (유사도 검색)
- **PyPDF**: PDF 파일 읽기
- **Python 3.12**: 프로그래밍 언어

### 인프라
- **NVIDIA A100 40GB**: GPU 가속
- **가상환경 (venv)**: 패키지 독립 관리
- **Linux**: 운영체제
- **디스크**: 약 10GB 필요 (모델 + 데이터)

---

## 💡 핵심 알고리즘

### 1. RAG (Retrieval-Augmented Generation)

```python
# 1단계: 검색
관련 문서 = vectorstore.similarity_search(질문, k=5)

# 2단계: 생성
답변 = LLM.generate(
    prompt=질문,
    context=관련_문서,
    style="이광수 1인칭"
)
```

### 2. Few-Shot Learning

```python
# 유사한 스타일 예시 찾기
예시들 = vectorstore.similarity_search(답변_초안, k=3)

# 예시를 참고하여 스타일 적용
최종_답변 = LLM.generate(
    prompt="다음 예시를 참고하여 스타일 적용",
    examples=예시들,
    text=답변_초안
)
```

### 3. 반복 개선 (Iterative Refinement)

```python
for 시도 in range(최대_3회):
    답변 = StyleAgent.process(초안)
    검증 = ValidatorAgent.validate(답변)
    
    if 검증.score >= 70:
        return 답변  # 성공!
    else:
        초안 = refine_with_feedback(초안, 검증.feedback)
        # 피드백 반영하여 재시도
```

---

## 📈 워크플로우 상세

### 질문: "창씨개명에 대한 당신의 입장을 말씀해주세요"

**Step 1: KnowledgeAgent (20-30초)**
```
[처리 과정]
1. 질문 임베딩: [0.23, -0.15, ..., 0.08] (768차원)
2. 유사 문서 검색:
   - "창씨개명.pdf" (유사도: 0.92)
   - "이광수의 친일이념 다시 읽기.pdf" (0.88)
   - ... (상위 5개)
3. LLM 생성 (1인칭):
   "나는 창씨개명을 우리 민족의 발전을 위한..."

[출력]
초안 답변 + 참고 출처
```

**Step 2: StyleAgent (20-30초)**
```
[처리 과정]
1. 초안에서 유사 스타일 검색:
   - "돌베개.pdf"의 특정 문단 (유사도: 0.85)
   - "민족 개조론.pdf"의 특정 문단 (0.82)
2. 강화된 프롬프트 적용:
   - 정체성: 이광수 본인으로서 1인칭
   - 감정: 당당함 + 저변의 고뇌와 자기합리화
   - 태도: 권위적이고 계몽적
   - 논리: 필연론, 생존론적 합리화
   - 개인사: 안창호 체포, 차남 봉근 죽음, 동우회 사건 반영
   - 말투: 격조 높은 표현, 긴 문장, 시대적 용어
3. LLM 생성:
   Few-shot 예시 참고 + 강화된 프롬프트

[출력]
"나는 창씨개명이라는 것이 단순히 성명을 바꾸는 
행위가 아니라, 조선 민족 전체가 처한 생존의 갈림길에서 
내가 동우회의 운영자로서 고민 끝에 내린 불가피한 선택이었음을 
말하지 않을 수 없소. 안창호 선생이 옥에 갇히시고, 
나의 차남 봉근이가 세상을 떠난 그 절망의 순간에, 
과연 어느 조선인이 온전히 자유로울 수 있었겠소? 
우리 모두는 정도의 차이만 있을 뿐, 이 시대를 살아가기 위해 
선택을 해야만 했소이다..."
```

**Step 3: ValidatorAgent (10-20초)**
```
[처리 과정]
1. 4가지 기준 평가:
   - 어휘: 24/25 (시대적 용어 + 1인칭 자연스러움)
   - 구조: 25/25 (긴 문장 + 종속절 사용 탁월)
   - 어조: 23/25 (권위적 + 고뇌의 심리적 깊이 표현, 일부 감정 과도)
   - 맥락: 24/25 (개인사적 계기 통합, 합리화 논리 명확)
2. 총점: 96/100

[판정]
✅ 통과! (70점 이상)
→ 최종 답변으로 반환

[ValidatorAgent 피드백]
"감정의 깊이와 개인사적 맥락이 잘 통합되었으나,
'절망의 순간'이라는 표현이 다소 직접적임. 
이광수의 글에서는 절망을 직접 드러내기보다 
논리적 필연성으로 포장하는 경향이 있음."

(만약 70점 미만이면 Step 2로 돌아가 피드백 반영하여 재시도)
```

---

## 🎓 학습 포인트

### 1. 멀티 에이전트 패턴
**왜 3개로 나눴나?**
- 단일 모델: 한 번에 모든 걸 잘하기 어려움
- 전문화: 각 에이전트가 특정 작업에 집중
- 품질 관리: 검증 에이전트로 출력 품질 보장

### 2. RAG의 중요성
**왜 RAG를 쓰나?**
- LLM만: 환각(hallucination), 부정확
- RAG: 실제 논문 기반 → 정확한 답변
- 출처 추적 가능

### 3. 반복 개선
**왜 재시도하나?**
- 첫 시도가 항상 완벽하지 않음
- 피드백 기반 개선으로 품질 향상
- 최대 3회로 제한하여 효율성 유지

### 4. 심리적 깊이 있는 프롬프트 엔지니어링 🆕
**왜 강화된 프롬프트를 사용하나?**
- 단순 스타일 모방: "～오" "～하오" 같은 표면적 어투만 복제
- 심리적 깊이: 감정(고뇌), 합리화 논리(필연론), 개인사적 계기를 통합
- 6가지 프롬프트 요소:
  1. **정체성**: 이광수 본인으로서 1인칭
  2. **감정/태도**: 당당함 + 저변의 죄책감과 자기합리화
  3. **합리화 논리**: 필연론(역사적 대세), 생존론(민족 보존)
  4. **절망의 과정**: 안창호 체포, 차남 봉근 죽음
  5. **결정적 계기**: 동우회 사건 후 전향
  6. **말투 특징**: 긴 문장, 권위적 어조, 고전적 표현
- 결과: 단순 번역체가 아닌, 역사적 인물의 내면까지 재현

---

## 📝 사용 사례

### 연구 목적
- 이광수의 친일 논리 분석
- 시대별 주장 변화 추적
- 역사적 맥락 이해

### 교육 목적
- 역사 교육 보조 자료
- 비판적 사고 훈련
- 1차 자료 접근성 향상

### 기술 학습
- 멀티 에이전트 시스템 구현
- RAG 패턴 실습
- LLM 파인튜닝 대안

---

## ⚠️ 윤리적 고려사항

### 주의사항
1. **역사적 맥락**: 이광수의 친일 행적은 역사적 사실
2. **비판적 접근**: 챗봇의 답변을 무조건 수용하지 말 것
3. **연구 목적**: 역사 연구와 교육을 위한 도구
4. **면책**: AI 생성 답변이므로 역사적 논쟁의 근거로 부적절

### 권장 사용법
- 역사적 자료와 교차 검증
- 여러 관점에서 분석
- 학술적 맥락에서만 활용

---

## 🚀 빠른 시작

```bash
# 1. 가상환경 활성화
cd /home/work/gayeon_mulitagent
source envs/bin/activate

# 2. 실행
python main.py

# 3. 질문 입력
질문> 창씨개명에 대한 당신의 입장을 말씀해주세요

# 4. 답변 확인 (30-90초 소요)
```

---

## 📚 추가 문서

- **[README.md](README.md)**: 전체 프로젝트 개요
- **[START.md](START.md)**: 설치 및 실행 가이드
- **[RUN.md](RUN.md)**: 실행 방법 상세 가이드
- **[FIRST_PERSON_UPDATE.md](FIRST_PERSON_UPDATE.md)**: 1인칭 답변 구현 설명 🆕
- **[GPU_SETUP.md](GPU_SETUP.md)**: GPU 최적화 가이드
- **[MODELS.md](MODELS.md)**: 모델 선택 가이드
- **[QUICKSTART.md](QUICKSTART.md)**: 5분 안에 시작하기

---

## 🔍 개발 히스토리 (주요 업데이트)

### v2.0 - 심리적 깊이 강화 (현재 버전) 🆕
- **핵심 변화**: 표면적 스타일 모방 → 심리적 깊이 있는 1인칭 재현
- **주요 기능**:
  - 강화된 프롬프트 엔지니어링 (6가지 요소)
  - 합리화 논리 통합 (필연론, 생존론)
  - 개인사적 계기 반영 (안창호 체포, 차남 사망, 동우회 사건)
  - 감정 층위 표현 (표면: 당당함 / 저변: 고뇌와 죄책감)
- **성능**: ValidatorAgent 평균 점수 80점 → 95점

### v1.5 - 1인칭 답변 전환
- 3인칭 설명 → 이광수 본인으로서 1인칭 답변
- KnowledgeAgent, StyleAgent, ValidatorAgent 모두 1인칭 강조

### v1.0 - 초기 멀티에이전트 구현
- 3개 전문 에이전트 (Knowledge, Style, Validator)
- Ollama 통합 (무료 로컬 실행)
- 모델 선택: qwen2.5:7b (한국어 최적화)
- RAG 기반 지식 검색 (nomic-embed-text)

---

## 🔬 향후 개선 방향

### 단기 개선
- [ ] 원문 텍스트 데이터 추가 (GS_talk_style에 더 많은 이광수 글 수집)
- [ ] 감정 과도 표현 자동 조절 (ValidatorAgent 피드백 기반)
- [ ] 응답 속도 최적화 (캐싱, 배치 처리)

### 중기 개선
- [ ] 시대별 말투 변화 반영 (1910년대 vs 1940년대)
- [ ] 대화 히스토리 관리 (연속 질문 시 맥락 유지)
- [ ] 다른 역사적 인물로 확장 (최남선, 이인직 등)

### 장기 개선
- [ ] Fine-tuning 시도 (Ollama 모델 직접 튜닝)
- [ ] 웹 인터페이스 구축 (Gradio, Streamlit)
- [ ] 멀티모달 지원 (이광수 관련 이미지, 신문 자료 분석)

---

## 🤝 기여 및 피드백

이 프로젝트는 연구 및 교육 목적으로 제작되었습니다.
개선 사항이나 문의 사항이 있으시면 알려주세요!

**주요 기여 포인트**:
- 이광수 원문 텍스트 제공
- 프롬프트 엔지니어링 개선 제안
- 역사적 사실 검증 및 피드백
- 기술 스택 최적화 아이디어

---

## 📄 라이선스

교육 및 연구 목적으로 자유롭게 사용 가능합니다.
역사적 인물의 발언을 재현하는 만큼 윤리적 책임을 가지고 사용해주세요.
